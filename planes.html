<!DOCTYPE html>
<html>
  <head></head>
  <style>
  html, 
  body {
    margin: 0;
    padding: 0;
    overflow: hidden;
  }
  #canvas {
    background: #000;
    width: 100%;
    height: 100%;
  }
  </style>
  <body>
    <canvas id="canvas"></canvas>
    <script src="utils.js"></script>
    <script src="animation.js"></script>
    <script src="vector.js"></script>
    <script src="particle.js"></script>
    <script>
    (function() {
      var ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      ctx.globalAlpha = .5;
      //ctx.globalCompositeOperation = 'lighter';
      ctx.lineWidth = 1;
      ctx.fillStyle = 'white';
      ctx.strokeStyle = 'white';

      function Ship(x, y) {
        this.fillColor = 'white';
        this.position = new Vector(x, y);
        this.oscillation = 0;
        this.size = 1;
        this.amp = 10;
      }

      Ship.prototype = new Particle();

      Ship.prototype.draw = function(ctx) {
        ctx.save();
        ctx.fillStyle = this.fillColor;
        ctx.translate(this.position.x, this.position.y + this.oscillation);
        ctx.scale(this.size, this.size);
        ctx.beginPath();
        ctx.moveTo(0, -15);
        ctx.lineTo(50, 0);
        ctx.lineTo(0, 15);
        ctx.closePath();
        ctx.fill();
        ctx.restore();
      }

      var ships = [];
      var group = {
        center: new Particle(0, utils.random(200, 300)),
        ships: ships
      }

      group.center.fillColor = 'white';
      //group.center.velocity = new Vector(1, 1);

      var attractors = [
        new Particle(200, 300),
        new Particle(800, 300)
      ];

      attractors[0].mass = 200;
      attractors[1].mass = 200;

      for (var i = 0; i < 7; i++) {
        var ship = new Ship(utils.random(-30, 30), utils.random(-30, 30));
        ship.size = utils.random(1, 5) / 5;
        ship.amp = utils.random(5, 10);
        ships.push(ship);
      }

      function draw() {
        var p = group.center;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        //group.center.x = 50 * counter;
        //group.center.y = 50 * Math.sin(counter);
        for (var i = 0, l = attractors.length; i < l; i++) {
          var force = attractors[i].attract(p);
          p.addForce(force);
        }

        p.update();
        //p.draw(ctx);

        ctx.save();
        ctx.translate(p.position.x, p.position.y);

        //ctx.translate(group.center.x, group.center.y);
        for(var i = 0, l = ships.length; i < l; i++) {
          ships[i].oscillation = ships[i].amp * Math.sin(counter);
          ships[i].draw(ctx);
        }
        ctx.restore();
      }

      var counter = 0;

      var anim = new AnimationFrame(function() {
        draw();  
        //this.stop();
        counter+= 0.05;     
      });

      document.body.addEventListener('mousemove', function(evt) {
        //attractors[0].position.x = evt.clientX;
        //attractors[0].position.y = evt.clientY;
      });

    })();
    </script>
  </body>
</html>