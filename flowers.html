<!DOCTYPE html>
<html>
  <head></head>
  <style>
  html, 
  body {
    margin: 0;
    padding: 0;
    overflow: hidden;
  }
  #canvas {
    background: rgb(255,240,225);
    width: 100%;
    height: 100%;
  }
  #params {
    position: absolute;
    padding: 20px;
  }
  </style>
  <body>
    <div id="params">
      <p>Position x: <span id="px"></span></p>
      <p>Position y: <span id="py"></span></p>
      <p>Velocity x: <span id="vx"></span></p>
      <p>Velocity y: <span id="vy"></span></p>
      <p>Quantity: <span id="q"></span></p>
      <p><button id="recreate">recreate</button></p>

    </div>
    <canvas id="canvas"></canvas>
    <script src="animation.js"></script>
    <script src="vector.js"></script>
    <script src="particle.js"></script>
    <script>
    (function() {
      var canvas = document.querySelector('#canvas');
      var pxn =  document.querySelector('#px');
      var pyn =  document.querySelector('#py');
      var vxn =  document.querySelector('#vx');
      var vyn =  document.querySelector('#vy');
      var qn =  document.querySelector('#q');
      var button =  document.querySelector('#recreate');

      button.addEventListener('click', function() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        timer = 0;
        particle.setPosition(pos.x, pos.y);
        particle.setVelocity(vel.x, vel.y);
        recreate = !recreate;
        console.log('click');
      })

      var ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight

      var middle = new Vector(Math.floor(window.innerWidth / 2), Math.floor(window.innerHeight / 2));
      //var middle = new Vector(random(window.innerWidth / 4, 3 * window.innerWidth / 4), random(window.innerHeight / 4, 3 * window.innerHeight / 4))

      var attractor = new Particle(middle.x + 300, middle.y);
      attractor.mass = 200;
      attractor.draw(ctx);

      var quantity = random(3000, 15000);
      //var pos = new Vector(random(400, 600), random(250, 350));

      // pxn.innerHTML = particle.position.x;
      // pyn.innerHTML = particle.position.y;
      // vxn.innerHTML = particle.velocity.x;
      // vyn.innerHTML = particle.velocity.y;
      // qn.innerHTML = quantity;

      ctx.strokeStyle = 'rgba(0,0,0,.1)';

      var particles = [];

      for (var i = 0; i < 10; i++) {
        var pos = new Vector(random(400, 600), random(250, 350));
        var vel = new Vector(random(0, 5), random(0, 5));
        var particle = new Particle();
        particle.position.add(pos);
        particle.velocity.add(vel);

        particles.push(particle);
      }
      // ctx.beginPath();
      // ctx.moveTo(particle.position.x, particle.position.y);

      // while (timer < quantity) {
      //   draw();
      //   timer++;
      // }

      // ctx.stroke();
      // ctx.endPath();

      var r = 5;
      var theta = 0;


      var anim = new AnimationFrame(function() {
        draw();        
      });

      function draw() {

        var prev = particles[0].position.copy();

        var x = r * Math.cos(theta) + 300;
        var y = r * Math.sin(theta) + 300;

        particles[0].setPosition(x, y);
        particles[0].update();
        //particles[0].draw(ctx);
        

        ctx.beginPath();
        ctx.moveTo(prev.x, prev.y);
        ctx.lineTo(particles[0].position.x, particles[0].position.y);
        ctx.stroke();
        ctx.closePath();
        
        theta += 0.1;
        r *= 1.005;
      }

      function random(min, max) {
        return min + Math.floor(Math.random() * (max - min + 1));
      }

    })();
    </script>
  </body>
</html>